<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<title>Form To Google Sheets Demo</title>
		<meta name="description" content="Store HTML form submissions in Google Sheets" />
		<link href="./favicon.png" rel="shortcut icon" />

		<link rel="stylesheet" href="main.css" />
	</head>
	<body>
		<div class="form-container">
			<div class="warning">
				<strong>Warning:</strong>
				Submissions will be publicly viewable in the Google Sheet linked below.
			</div>
			<form name="submit-to-google-sheet">
				<div>
					<input name="email" type="email" placeholder="Email" autocomplete="email" required />
				</div>
				<input name="firstName" type="text" placeholder="First Name" />
				<input name="lastName" type="text" placeholder="Last Name" />
				<button type="submit">Subscribe</button>
			</form>

			<div class="loading js-loading is-hidden">
				<div class="loading-spinner">
					<svg>
						<circle
							cx="25"
							cy="25"
							r="20"
							fill="none"
							stroke-width="2"
							stroke-miterlimit="10" />
					</svg>
				</div>
			</div>

			<p class="js-success-message is-hidden">Success!</p>
			<p class="js-error-message is-hidden">Error!</p>
		</div>

		<a
			href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSYXULfaji_9SUp9j7mkLJwxXfFbayz_TSMQZ8_7vpVU-BO0ZJkjbAbVuVjh9kIis7qQdyVUjtG__uh/pubhtml?gid=0&single=true"
			target="_blank">
			View the Google Sheet
		</a>

		<a href="https://github.com/jamiewilson/form-to-google-sheets" target="_blank">
			View on GitHub
		</a>

		<script>
			const scriptURL =
				'https://script.google.com/macros/s/AKfycbzTSvKKCzCg_Da3GwDBYbh69QRP-d1wBifGJ3OdKSb6C973TY_caTm0-VEwlruBWc8/exec'
			const form = document.forms['submit-to-google-sheet']
			const loading = document.querySelector('.js-loading')
			const successMessage = document.querySelector('.js-success-message')
			const errorMessage = document.querySelector('.js-error-message')

			form.addEventListener('submit', e => {
				e.preventDefault()
				showLoadingIndicator()
				fetch(scriptURL, { method: 'POST', body: new FormData(form) })
					.then(response => showSuccessMessage(response))
					.catch(error => showErrorMessage(error))
			})

			function showLoadingIndicator() {
				form.classList.add('is-hidden')
				loading.classList.remove('is-hidden')
			}

			function showSuccessMessage(response) {
				console.log('Success!', response)
				setTimeout(() => {
					successMessage.classList.remove('is-hidden')
					loading.classList.add('is-hidden')
				}, 500)
			}

			function showErrorMessage(error) {
				console.error('Error!', error.message)
				setTimeout(() => {
					errorMessage.classList.remove('is-hidden')
					loading.classList.add('is-hidden')
				}, 500)
			}
		</script>
	</body>
</html>
